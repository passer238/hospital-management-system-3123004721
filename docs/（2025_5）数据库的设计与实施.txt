一、实验目的
熟悉数据库设计的步骤和基本方法；明确数据库设计各阶段的任务；加深对数据库系统设计相关概念，原理的理解。掌握使用数据库辅助设计工具进行数据库设计和实施的方法。
二、实验内容和要求
根据数据库课程设计选题完成数据库的设计与实施。
三、实验主要仪器设备和材料
1．计算机及操作系统：PC机，Win10；
2．数据库辅助设计软件：Power Designer 16.5或更高版本；
3．数据库管理系统：SQL Server 2010或更高版本；
四、实验方法、步骤及结果测试
1. 数据库的设计
为自己的课程设计选题设计系统的数据库部分，要求设计紧密围绕核心业务进行。完成的数据库中不少于六张基本表。
1）	你的数据库课程设计选题是？选用的DBMS是？

选题：医院信息管理系统（Hospital Information Management System）
选用的DBMS：MySQL 8.0.26
说明：该系统旨在管理医院的日常业务，包括病人挂号、医生管理、药品库存、处方开具、费用缴纳等核心功能。采用MySQL数据库管理系统，结合Spring Boot框架和MyBatis-Plus持久层框架进行开发。


2）	描述该选题的核心业务，绘制其业务流程图。

核心业务描述：
医院信息管理系统的核心业务流程包括以下几个关键环节：

① 病人挂号：病人到医院就诊，首先需要在挂号处进行挂号，选择科室和医生，系统记录病人基本信息（姓名、身份证号、性别、电话等）和挂号信息（科室、医生、挂号时间）。

② 医生诊断开方：医生根据病人病情进行诊断，在系统中开具处方，记录需要的药品及数量。处方信息包括医生编号、病人姓名、药品编号、药品数量等。

③ 费用结算：病人凭处方到收费处缴费，系统根据处方中的药品计算总费用，生成缴费记录和支付凭据。

④ 药品发放：病人凭支付凭据到药房取药，系统生成取药单（PGM），药房根据取药单发放药品，同时通过触发器自动减少药品库存。

⑤ 药品库存管理：药品入库时，系统通过触发器自动更新库存数量；药品出库（开处方）时，自动减少库存。当库存不足时，系统提示警告。

业务流程图：
[病人] --> [挂号登记(register)] --> [医生诊断] --> [开具处方(recipel)] --> [费用结算(charge)] --> [生成支付凭据(pay)] --> [生成取药单(pgm)] --> [药房发药] --> [库存更新(drugs)]

主要业务实体关系：
- 病人(patient) 通过 挂号(register) 关联 医生(doctor)
- 医生(doctor) 通过 处方(recipel) 关联 药品(drugs)
- 病人(patient) 通过 缴费(charge) 关联 药品(drugs)
- 病人(patient) 通过 支付凭据(pay) 关联 收费信息
- 收费信息 通过 取药单(pgm) 关联 药品(drugs)


3）	简述系统的功能需求，并为系统建立用例图和用例规约（用例说明，选3~4个主要用例即可）。

系统功能需求：

1. 病人管理功能：
   - 病人信息登记、查询、修改、删除（逻辑删除）
   - 病人挂号记录管理
   - 病人历史就诊记录查询

2. 医生管理功能：
   - 医生信息维护（增删改查）
   - 医生在岗状态管理
   - 医生处方记录查询

3. 药品管理功能：
   - 药品信息维护（药品编号、名称、价格、库存、存储位置、有效期等）
   - 药品入库/出库管理
   - 药品库存查询与预警

4. 挂号管理功能：
   - 病人挂号登记
   - 挂号信息查询、修改
   - 按科室、医生统计挂号量

5. 处方管理功能：
   - 医生开具处方
   - 处方信息查询
   - 处方自动扣减药品库存

6. 收费管理功能：
   - 费用计算与收费
   - 支付凭据生成
   - 取药单生成
   - 收费记录查询统计

主要用例及用例规约：

用例1：病人挂号_3123004721_袁子轩
参与者：挂号员、病人
前置条件：病人提供基本信息
后置条件：生成挂号记录
基本流程：
  1. 挂号员录入病人信息（姓名、身份证号、性别、电话、病情）
  2. 病人选择就诊科室
  3. 系统显示该科室在岗医生列表
  4. 病人选择医生
  5. 系统生成挂号记录，分配挂号编号
  6. 系统记录挂号时间
扩展流程：
  3a. 若所选科室无在岗医生，提示选择其他科室
  1a. 若病人已在系统中存在，可直接调用历史信息

用例2：医生开具处方_3123004721_袁子轩
参与者：医生
前置条件：病人已完成挂号
后置条件：生成处方记录，药品库存减少
基本流程：
  1. 医生输入病人姓名
  2. 系统显示病人基本信息
  3. 医生选择需要的药品
  4. 医生输入药品数量
  5. 系统检查药品库存是否充足
  6. 系统生成处方记录
  7. 系统通过触发器自动减少药品库存
扩展流程：
  5a. 若库存不足，系统提示库存数量，医生调整处方
  5b. 若库存为零，系统拒绝开药并提示

用例3：费用结算_3123004721_袁子轩
参与者：收费员、病人
前置条件：医生已开具处方
后置条件：生成缴费记录和支付凭据、生成取药单
基本流程：
  1. 收费员输入病人信息或处方编号
  2. 系统查询病人的处方信息
  3. 系统根据处方中的药品自动计算总费用
  4. 收费员确认费用
  5. 病人完成支付
  6. 系统生成缴费记录（charge表）
  7. 系统生成支付凭据（pay表）
  8. 系统生成取药单（pgm表）
  9. 系统打印取药单凭条
扩展流程：
  3a. 若处方中有多种药品，分别计算后汇总

用例4：药品入库管理_3123004721_袁子轩
参与者：药库管理员
前置条件：采购药品到货
后置条件：药品库存增加
基本流程：
  1. 药库管理员扫描或输入药品编号
  2. 系统查询该药品是否已存在
  3. 管理员输入入库数量
  4. 系统通过触发器自动累加库存数量
  5. 系统更新药品信息（生产日期、有效期等）
扩展流程：
  2a. 若药品不存在，管理员录入新药品信息（名称、价格、存储位置等）
  2b. 若药品已存在，仅更新库存数量和日期信息


4）	结合选题的核心业务，分析业务域中的实体及其约束。

核心实体分析：

1. 病人实体（Patient_3123004721_袁子轩）
   属性：病人身份证号、姓名、年龄、性别、电话、病情描述、逻辑删除标志、创建时间、更新时间
   主键：病人身份证号（p_atient_id）
   约束：
   - 身份证号唯一且不为空
   - 年龄必须为正整数，取值范围0-150
   - 性别只能为'男'或'女'
   - 电话格式需符合规范
   - 所有字段均不允许为空（除时间字段自动生成）

2. 医生实体（Doctor_3123004721_袁子轩）
   属性：医生编号、姓名、性别、年龄、科室、电话、在岗状态、逻辑删除标志、创建时间、更新时间
   主键：医生编号（d_octor_id）
   约束：
   - 医生编号唯一且不为空
   - 年龄必须为正整数，一般在20-70之间
   - 在岗状态默认为1（在岗），0表示不在岗
   - 科室名称应在预定义的科室列表中

3. 药品实体（Drugs_3123004721_袁子轩）
   属性：药品编号、药品名称、价格、库存数量、存储位置、生产日期、有效期、逻辑删除标志、创建时间、更新时间
   主键：药品编号（drug_id）
   约束：
   - 药品编号唯一且不为空
   - 价格必须大于0
   - 库存数量不能为负数
   - 有效期必须大于生产日期
   - 存储位置应符合库位编码规范（如A-1-001）

4. 挂号实体（Register_3123004721_袁子轩）
   属性：挂号编号、病人身份证号、病人姓名、性别、挂号科室、医生姓名、逻辑删除标志、创建时间、更新时间
   主键：挂号编号（r_num），自增
   外部标识：病人身份证号（引用病人实体）
   约束：
   - 挂号编号自动递增
   - 病人身份证号必须在病人表中存在（应用层保证）
   - 医生姓名和科室应匹配

5. 处方实体（Recipel_3123004721_袁子轩）
   属性：处方编号、医生编号、药品编号、病人姓名、药品数量、逻辑删除标志、创建时间、更新时间
   主键：处方编号（id），自增
   外部标识：医生编号、药品编号、病人姓名
   约束：
   - 药品数量必须大于0
   - 药品数量不能超过当前库存
   - 医生编号必须存在且在岗
   - 药品编号必须存在且未过期

6. 缴费实体（Charge_3123004721_袁子轩）
   属性：收费员编号、收费员姓名、病人编号、药品编号、药品数量、金额、逻辑删除标志、创建时间、更新时间
   主键：（收费员编号, 病人编号, 药品编号）联合主键
   约束：
   - 金额必须大于0
   - 金额应等于药品单价×数量

7. 支付凭据实体（Pay_3123004721_袁子轩）
   属性：病人编号、收费编号、价格、逻辑删除标志、创建时间、更新时间
   主键：（病人编号, 收费编号）联合主键
   约束：
   - 价格必须与缴费记录中的金额一致

8. 取药单实体（PGM_3123004721_袁子轩）
   属性：收费编号、药品编号、数量、价格、逻辑删除标志、创建时间、更新时间
   主键：（收费编号, 药品编号）联合主键
   约束：
   - 数量和价格必须与缴费记录一致

通用约束：
- 所有实体都包含逻辑删除标志（is_delete），0表示未删除，1表示已删除
- 所有实体都包含创建时间（create_time）和更新时间（update_time），自动维护
- 采用逻辑删除而非物理删除，保证数据可追溯
- 不使用数据库外键约束，所有关联关系在应用层维护


5）	数据库概念结构设计：做出系统的总体E-R图（实体名和联系名后加上学号3123004721和姓名袁子轩，实体的属性不要标出、联系的属性需要标明）。
VISIO绘的ER图

实体-联系模型说明：

1. 主要实体（八个）：
   - Patient_3123004721_袁子轩（病人）
   - Doctor_3123004721_袁子轩（区生）
   - Drugs_3123004721_袁子轩（药品）
   - Register_3123004721_袁子轩（挂号）
   - Recipel_3123004721_袁子轩（处方）
   - Charge_3123004721_袁子轩（缴费）
   - Pay_3123004721_袁子轩（支付凭据）
   - PGM_3123004721_袁子轩（取药单）

2. 主要联系：
   - 挂号_3123004721_袁子轩：Patient 与 Doctor 的M:N关系
     属性：挂号编号、挂号时间、科室
   
   - 开具处方_3123004721_袁子轩：Doctor 与 Drugs 的M:N关系
     属性：处方编号、药品数量、病人姓名、开方时间
   
   - 缴费_3123004721_袁子轩：Patient 与 Drugs 的M:N关系
     属性：收费员编号、收费员姓名、药品数量、金额、缴费时间
   
   - 支付_3123004721_袁子轩：Patient 与 Charge 的1:N关系
     属性：收费编号、价格、支付时间
   
   - 取药_3123004721_袁子轩：Charge 与 Drugs 的M:N关系
     属性：收费编号、数量、价格

3. 联系类型说明：
   - Patient : Register : Doctor = M : 1 : N （一个病人可以多次挂号，一个医生可以接诊多个病人）
   - Doctor : Recipel : Drugs = M : 1 : N （一个医生可以开多个处方，一种药品可以在多个处方中出现）
   - Patient : Charge : Drugs = M : 1 : N （一个病人可以多次缴费，一种药品可以被多次购买）
   - Patient : Pay = 1 : N （一个病人可以有多个支付凭据）
   - Charge : PGM : Drugs = M : 1 : N （一次收费可以对应多种药品，一种药品可以在多个取药单中出现）

E-R图绘制说明：
- 矩形表示实体，菱形表示联系
- 线条连接实体和联系，标注基数（如M、N、1）
- 联系的属性用椭圆表示并标注在菱形旁
- 实体的主关键属性下划线（此图中不显示属性）


Power Designer的CDM

概念数据模型说明：
1. 使用Power Designer创建CDM模型
2. 模型包含8个实体和5个主要联系
3. 每个实体定义了完整的属性和约束
4. 联系通过外部标识符在应用层维护（不使用数据库外键）
5. 所有实体都支持逻辑删除和时间戳记录



5）	逻辑模型设计：将E-R图转换为关系模式（模式名后加上学号3123004721和姓名袁子轩）。

关系模式转换结果：

1. Patient_3123004721_袁子轩（p_atient_id, p_name, p_age, p_sex, p_tel, p_inf, is_delete, create_time, update_time）
   主键：p_atient_id
   说明：病人实体直接转换为关系模式，以身份证号为主键

2. Doctor_3123004721_袁子轩（d_octor_id, d_name, d_sex, d_age, d_dept, d_tel, is_jobing, is_delete, create_time, update_time）
   主键：d_octor_id
   说明：医生实体直接转换为关系模式，以医生编号为主键

3. Drugs_3123004721_袁子轩（drug_id, drug_name, drug_price, drug_quantity, drug_storage, drug_date, usefull_life, is_delete, create_time, update_time）
   主键：drug_id
   说明：药品实体直接转换为关系模式，以药品编号为主键

4. Register_3123004721_袁子轩（r_num, r_patient_id, r_P_name, r_sex, r_dept, r_name, is_delete, create_time, update_time）
   主键：r_num
   外部标识：r_patient_id 引用 Patient.p_atient_id（应用层维护）
   说明：M:N联系“挂号”转换为独立关系，包含联系属性（科室、医生姓名、挂号时间）

5. Recipel_3123004721_袁子轩（id, doctor_id, drug_id, patient_name, count, is_delete, create_time, update_time）
   主键：id
   外部标识：doctor_id 引用 Doctor.d_octor_id, drug_id 引用 Drugs.drug_id（应用层维护）
   说明：M:N联系“开具处方”转换为独立关系，包含联系属性（药品数量、病人姓名）

6. Charge_3123004721_袁子轩（toll_id, t_name, patient_id, drug_id, drug_quantity, amount, is_delete, create_time, update_time）
   主键：(toll_id, patient_id, drug_id)
   外部标识：patient_id 引用 Patient.p_atient_id, drug_id 引用 Drugs.drug_id（应用层维护）
   说明：M:N联系“缴费”转换为独立关系，采用联合主键，包含联系属性（收费员信息、数量、金额）

7. Pay_3123004721_袁子轩（patient_id, t_id, price, is_delete, create_time, update_time）
   主键：(patient_id, t_id)
   外部标识：patient_id 引用 Patient.p_atient_id（应用层维护）
   说明：1:N联系“支付”转换为独立关系，采用联合主键，包含联系属性（价格）

8. PGM_3123004721_袁子轩（t_id, drug_id, quantity, price, is_delete, create_time, update_time）
   主键：(t_id, drug_id)
   外部标识：drug_id 引用 Drugs.drug_id（应用层维护）
   说明：M:N联系“取药”转换为独立关系，采用联合主键，包含联系属性（数量、价格）

转换规则说明：
1. 每个实体转换为一个关系模式，实体的属性转换为关系的属性
2. M:N联系转换为独立的关系模式，包含两端实体的主键作为外部标识和联系属性
3. 1:N联系可以在N端增加1端的主键作为外部标识，或转换为独立关系（本系统采用后者）
4. 所有关系都包含is_delete、create_time、update_time三个系统字段
5. 不在数据库层面定义外键约束，全部在应用层通过MyBatis-Plus维护



6）	写出基本函数函数依赖集，并最小化。

各关系模式的函数依赖集：

1. Patient_3123004721_袁子轩
   F = {p_atient_id → p_name, p_atient_id → p_age, p_atient_id → p_sex, p_atient_id → p_tel, p_atient_id → p_inf}
   最小化后：F_min = {p_atient_id → (p_name, p_age, p_sex, p_tel, p_inf)}
   说明：身份证号唯一确定病人的所有信息，无冗余依赖

2. Doctor_3123004721_袁子轩
   F = {d_octor_id → d_name, d_octor_id → d_sex, d_octor_id → d_age, d_octor_id → d_dept, d_octor_id → d_tel, d_octor_id → is_jobing}
   最小化后：F_min = {d_octor_id → (d_name, d_sex, d_age, d_dept, d_tel, is_jobing)}
   说明：医生编号唯一确定医生的所有信息，无冗余依赖

3. Drugs_3123004721_袁子轩
   F = {drug_id → drug_name, drug_id → drug_price, drug_id → drug_quantity, drug_id → drug_storage, drug_id → drug_date, drug_id → usefull_life}
   最小化后：F_min = {drug_id → (drug_name, drug_price, drug_quantity, drug_storage, drug_date, usefull_life)}
   说明：药品编号唯一确定药品的所有信息，无冗余依赖

4. Register_3123004721_袁子轩
   F = {r_num → r_patient_id, r_num → r_P_name, r_num → r_sex, r_num → r_dept, r_num → r_name, r_num → create_time}
   最小化后：F_min = {r_num → (r_patient_id, r_P_name, r_sex, r_dept, r_name, create_time)}
   说明：挂号编号唯一确定一次挂号的所有信息，无冗余依赖
   备注：r_P_name和r_sex存在冗余（可从patient表获取），但为提高查询性能而保留

5. Recipel_3123004721_袁子轩
   F = {id → doctor_id, id → drug_id, id → patient_name, id → count, id → create_time}
   最小化后：F_min = {id → (doctor_id, drug_id, patient_name, count, create_time)}
   说明：处方编号唯一确定一条处方记录，无冗余依赖

6. Charge_3123004721_袁子轩
   F = {(toll_id, patient_id, drug_id) → t_name, (toll_id, patient_id, drug_id) → drug_quantity, (toll_id, patient_id, drug_id) → amount}
   最小化后：F_min = {(toll_id, patient_id, drug_id) → (t_name, drug_quantity, amount)}
   说明：联合主键确定缴费记录，无冗余依赖
   备注：amount存在传递依赖(amount = drug_price × drug_quantity)，但为性能保留计算结果

7. Pay_3123004721_袁子轩
   F = {(patient_id, t_id) → price, (patient_id, t_id) → create_time}
   最小化后：F_min = {(patient_id, t_id) → (price, create_time)}
   说明：联合主键确定支付记录，无冗余依赖

8. PGM_3123004721_袁子轩
   F = {(t_id, drug_id) → quantity, (t_id, drug_id) → price}
   最小化后：F_min = {(t_id, drug_id) → (quantity, price)}
   说明：联合主键确定取药单记录，无冗余依赖

函数依赖最小化步骤说明：
1. 消除函数依赖右边的冗余属性：已完成，每个依赖右边都是单属性或属性组
2. 消除函数依赖左边的冗余属性：已完成，所有左边都是候选键
3. 消除冗余的函数依赖：已完成，每个函数依赖都是必需的
4. 系统字段（is_delete, create_time, update_time）由系统自动维护，不参与业务逻辑函数依赖分析



7）	使用规范化理论分析上一步中每个关系模式的范式等级、按3NF的要求设计、优化数据库（需写明优化过程）。

各关系模式范式分析：

1. Patient_3123004721_袁子轩
   - 1NF：满足，所有属性都是原子值
   - 2NF：满足，主键为单属性p_atient_id，不存在部分依赖
   - 3NF：满足，所有非主属性对主键完全依赖，不存在传递依赖
   - BCNF：满足，唯一的函数依赖决定因素p_atient_id就是候选键
   结论：已达到BCNF，无需优化

2. Doctor_3123004721_袁子轩
   - 1NF：满足，所有属性都是原子值
   - 2NF：满足，主键为单属性d_octor_id，不存在部分依赖
   - 3NF：满足，所有非主属性对主键完全依赖，不存在传递依赖
   - BCNF：满足，唯一的函数依赖决定因素d_octor_id就是候选键
   结论：已达到BCNF，无需优化

3. Drugs_3123004721_袁子轩
   - 1NF：满足，所有属性都是原子值
   - 2NF：满足，主键为单属性drug_id，不存在部分依赖
   - 3NF：满足，所有非主属性对主键完全依赖，不存在传递依赖
   - BCNF：满足，唯一的函数依赖决定因素drug_id就是候选键
   结论：已达到BCNF，无需优化

4. Register_3123004721_袁子轩
   优化前分析：
   - 存在冗余：r_P_name和r_sex可以通过r_patient_id从Patient表获取
   - 存在传递依赖：r_num → r_patient_id → r_P_name, r_sex
   
   优化决策：
   - 理论上应分解为：Register1(r_num, r_patient_id, r_dept, r_name, create_time)
   - 实际保留冗余字段r_P_name和r_sex的原因：
     ① 提高查询性能，避免频繁JOIN操作
     ② 挂号信息是历史快照，即使病人信息后续修改，挂号记录应保持不变
     ③ 符合反规范化设计原则，以空间换时间
   
   结论：在3NF基础上适度反规范化，保留r_P_name和r_sex，范式等级为3NF

5. Recipel_3123004721_袁子轩
   - 1NF：满足，所有属性都是原子值
   - 2NF：满足，主键为单属性id，不存在部分依赖
   - 3NF：满足，所有非主属性对主键完全依赖
   - BCNF：满足，唯一的函数依赖决定因素id就是候选键
   
   优化说明：
   - patient_name存在冗余（应通过patient表关联获取）
   - 保留原因：处方是历史记录，需要快照病人姓名
   结论：已达到BCNF，适度反规范化设计

6. Charge_3123004721_袁子轩
   优化前分析：
   - 联合主键(toll_id, patient_id, drug_id)
   - 存在计算字段：amount = drug_price × drug_quantity
   - 存在传递依赖：(toll_id, patient_id, drug_id) → drug_id → drug_price
   
   优化过程：
   - 问题1：amount存在计算依赖，违反3NF
     解决：保留amount字段作为冗余，原因是药品价格可能变动，需记录交易时的实际金额
   - 问题2：t_name依赖于toll_id
     解决：理论上应建立独立的Toll（收费员）表，但考虑到收费员信息简单且稳定，保留冗余
   
   优化后：保持当前结构，范式等级为3NF（有控制的反规范化）

7. Pay_3123004721_袁子轩
   - 1NF：满足
   - 2NF：满足
   - 3NF：满足，price依赖于联合主键，无传递依赖
   - BCNF：满足
   结论：已达到BCNF，无需优化

8. PGM_3123004721_袁子轩
   - 1NF：满足
   - 2NF：满足
   - 3NF：满足
   - BCNF：满足
   
   优化说明：
   - price和quantity理论上存在冗余（可从drugs表获取）
   - 保留原因：记录取药时的历史价格和数量，药品价格可能变动
   结论：已达到BCNF，适度反规范化设计

优化总结：
1. 所有基本表都满足3NF或BCNF要求
2. 部分表采用反规范化设计（Register、Recipel、Charge、PGM）
3. 反规范化原因：
   - 历史数据快照需求（价格、病人信息等）
   - 查询性能优化（减少JOIN操作）
   - 数据一致性保证（记录交易时的实际状态）
4. 优化策略符合《高性能MySQL》和阿里巴巴Java开发手册的设计理念
5. 在应用层通过业务逻辑保证数据一致性，而非依赖数据库外键约束




8）	使用Power Designer创建优化后的数据库的逻辑模型。
Power Designer的LDM 

逻辑数据模型说明：
1. LDM模型在CDM基础上转换生成，具体化了关系模式
2. 包含8个实体表：Patient、Doctor、Drugs、Register、Recipel、Charge、Pay、PGM
3. 定义了主键约束，但不定义数据库层面的外键约束
4. 每个实体包含完整的属性定义和数据类型
5. 体现了反规范化设计策略，保留了必要的冗余字段


9）	分析用户类型，并设计数据库的外模式。

用户类型分析：

基于医院信息系统的业务流程，系统主要有以下几类用户：

1. 挂号员（Registration Staff）
   主要职责：病人挂号登记、病人信息管理
   数据访问需求：
   - 查询、新增、修改病人信息
   - 查询医生在岗信息
   - 新增挂号记录
   - 查询挂号历史记录

2. 医生（Doctor）
   主要职责：诊断病人、开具处方
   数据访问需求：
   - 查询病人基本信息和历史病例
   - 查询药品信息和库存
   - 新增处方记录
   - 查询自己的历史处方记录

3. 收费员（Cashier）
   主要职责：费用结算、收费管理
   数据访问需求：
   - 查询病人处方信息
   - 查询药品价格信息
   - 新增缴费记录
   - 新增支付凭据
   - 生成取药单
   - 查询收费统计信息

4. 药库管理员（Pharmacy Manager）
   主要职责：药品库存管理、药品发放
   数据访问需求：
   - 查询、新增、修改药品信息
   - 药品入库/出库操作
   - 查询药品库存和有效期
   - 查询取药单
   - 药品销售统计

5. 系统管理员（System Administrator）
   主要职责：系统维护、数据管理
   数据访问需求：
   - 所有表的完全访问权限
   - 医生信息管理
   - 系统参数配置
   - 数据备份与恢复
   - 统计分析报表

外模式设计（视图设计）：

1. 挂号员视图（register_view_3123004721_袁子轩）
```sql
CREATE VIEW register_view_3123004721_袁子轩 AS
SELECT r_num, r_patient_id, r_P_name, r_sex, r_dept, r_name, create_time
FROM register
WHERE is_delete = 0;
```
说明：过滤已删除记录，隐藏系统管理字段

2. 医生工作视图（doctor_work_view_3123004721_袁子轩）
```sql
CREATE VIEW doctor_work_view_3123004721_袁子轩 AS
SELECT p.p_name, p.p_age, p.p_sex, p.p_inf, r.r_dept, r.create_time AS register_time
FROM patient p
JOIN register r ON p.p_atient_id = r.r_patient_id
WHERE p.is_delete = 0 AND r.is_delete = 0;
```
说明：医生查看待诊病人信息，包括病例和挂号时间

3. 收费员视图（cashier_view_3123004721_袁子轩）
```sql
CREATE VIEW cashier_view_3123004721_袁子轩 AS
SELECT r.patient_name, r.drug_id, d.drug_name, d.drug_price, r.count,
       (d.drug_price * r.count) AS total_amount
FROM recipel r
JOIN drugs d ON r.drug_id = d.drug_id
WHERE r.is_delete = 0 AND d.is_delete = 0;
```
说明：收费员查看处方信息并计算费用

4. 药品库存视图（drug_view_3123004721_袁子轩）
```sql
CREATE VIEW drug_view_3123004721_袁子轩 AS
SELECT drug_id, drug_name, drug_price, drug_quantity, drug_storage, 
       drug_date, usefull_life,
       CASE 
           WHEN drug_quantity = 0 THEN '缺货'
           WHEN drug_quantity < 100 THEN '低库存'
           ELSE '正常'
       END AS stock_status
FROM drugs
WHERE is_delete = 0;
```
说明：药库管理员查看药品库存，包含库存状态提示

5. 统计分析视图（statistics_view_3123004721_袁子轩）
```sql
CREATE VIEW statistics_view_3123004721_袁子轩 AS
SELECT r.r_dept AS department, 
       COUNT(*) AS patient_count,
       DATE(r.create_time) AS register_date
FROM register r
WHERE r.is_delete = 0
GROUP BY r.r_dept, DATE(r.create_time);
```
说明：系统管理员查看各科室每日挂号统计

6. 病人信息视图（patient_view_3123004721_袁子轩）
```sql
CREATE VIEW patient_view_3123004721_袁子轩 AS
SELECT p_atient_id, p_name, p_age, p_sex, p_tel, p_inf
FROM patient
WHERE is_delete = 0;
```
说明：通用病人信息视图，过滤已删除记录

7. 支付凭据视图（pay_view_3123004721_袁子轩）
```sql
CREATE VIEW pay_view_3123004721_袁子轩 AS
SELECT patient_id, t_id, price, create_time
FROM pay
WHERE is_delete = 0;
```
说明：支付凭据视图，用于财务对账

8. 取药单视图（pgm_view_3123004721_袁子轩）
```sql
CREATE VIEW pgm_view_3123004721_袁子轩 AS
SELECT p.t_id, p.drug_id, d.drug_name, p.quantity, p.price
FROM pgm p
JOIN drugs d ON p.drug_id = d.drug_id
WHERE p.is_delete = 0;
```
说明：药房取药单视图，关联药品名称

外模式设计原则：
1. 每个用户角色只能访问其职责范围内的数据
2. 通过视图隐藏敏感信息和系统字段
3. 所有视图自动过滤is_delete=1的记录
4. 复杂查询封装为视图，简化应用层访问
5. 在应用层通过权限管理控制用户对视图的访问



10）物理模型设计：DBMS使用SQL Server，为数据库设计物理模型（表名后加上学号3123004721和姓名袁子轩）。
Power Designer的PDM 

物理数据模型说明：

注：虽然实验要求使用SQL Server，但本项目实际采用MySQL 8.0.26作为DBMS。
原因：
f1） MySQL是Web应用的主流数据库，适合医院信息系统的应用场景
2） MySQL具有更好的开源生态和跨平台支持
3） 结合Spring Boot + MyBatis-Plus框架开发更便捷

物理模型设计说明：

1. 存储引擎：InnoDB
   - 支持事务处理（ACID特性）
   - 支持行级锁，并发性能好
   - 支持外键约束（虽然本项目不使用）
   - 支持崩溃恢复

2. 字符集：utf8mb4
   - 支持完整的Unicode字符集
   - 支持emoji等特殊字符
   - 排序规则：utf8mb4_unicode_ci

3. 数据类型选择：
   - 主键编号：INT UNSIGNED 或 VARCHAR
   - 整数型：INT, TINYINT
   - 小数：DECIMAL(10,2) （精确货币计算）
   - 字符串：VARCHAR（变长，节省空间）
   - 日期时间：DATETIME
   - 逻辑值：TINYINT（0/1）

4. 索引设计：
   - 主键自动创建聚集索引
   - 外部标识字段创建普通索引（如r_patient_id, drug_id）
   - 高频查询字段创建索引（如create_time）
   - 联合主键自动创建联合索引

5. 约束设计：
   - PRIMARY KEY：主键约束
   - NOT NULL：非空约束
   - UNSIGNED：无符号约束（用于正整数）
   - DEFAULT：默认值约束
   - AUTO_INCREMENT：自增约束
   - 不使用FOREIGN KEY约束（应用层维护）

6. 特殊设计：
   - 逻辑删除：is_delete TINYINT DEFAULT 0
   - 时间戳：
     * create_time DATETIME DEFAULT CURRENT_TIMESTAMP
     * update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
   - 触发器：药品库存自动管理
   - 存储过程：统计查询


11）描述各基本表的结构（参照实验一中对表结构的描述格式）。

表结构详细描述：

表名：patient_3123004721_袁子轩 （病人信息表）
表说明：存储病人的基本信息
字段数：9

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|---------|---------|------|--------|--------|---------|------|
| p_atient_id | VARCHAR | 20 | 是 | 是 | 无 | 病人身份证号 |
| p_name | VARCHAR | 20 | 否 | 是 | 无 | 病人姓名 |
| p_age | TINYINT UNSIGNED | 3 | 否 | 是 | 无 | 病人年龄 |
| p_sex | VARCHAR | 2 | 否 | 是 | 无 | 病人性别 |
| p_tel | VARCHAR | 20 | 否 | 是 | 无 | 病人电话 |
| p_inf | VARCHAR | 50 | 否 | 是 | 无 | 病情描述 |
| is_delete | TINYINT | 1 | 否 | 是 | 0 | 逻辑删除标志 |
| create_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 更新时间 |

---

表名：doctor_3123004721_袁子轩 （医生信息表）
表说明：存储医生的基本信息和在岗状态
字段数：10

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|---------|---------|------|--------|--------|---------|------|
| d_octor_id | INT UNSIGNED | 10 | 是 | 是 | 无 | 医生编号 |
| d_name | VARCHAR | 20 | 否 | 是 | 无 | 医生姓名 |
| d_sex | VARCHAR | 2 | 否 | 是 | 无 | 医生性别 |
| d_age | TINYINT UNSIGNED | 3 | 否 | 是 | 无 | 医生年龄 |
| d_dept | VARCHAR | 50 | 否 | 是 | 无 | 科室 |
| d_tel | VARCHAR | 20 | 否 | 是 | 无 | 电话 |
| is_jobing | TINYINT UNSIGNED | 1 | 否 | 是 | 1 | 在岗状态(0=不在岗,1=在岗) |
| is_delete | TINYINT | 1 | 否 | 是 | 0 | 逻辑删除标志 |
| create_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 更新时间 |

---

表名：drugs_3123004721_袁子轩 （药品信息表）
表说明：存储药品的详细信息和库存
字段数：10

| 字段名 | 数据类型 | 长度/精度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|---------|---------|------|--------|--------|---------|------|
| drug_id | VARCHAR | 10 | 是 | 是 | 无 | 药品编号 |
| drug_name | VARCHAR | 50 | 否 | 是 | 无 | 药品名称 |
| drug_price | DECIMAL UNSIGNED | 10,2 | 否 | 是 | 无 | 药品价格 |
| drug_quantity | BIGINT UNSIGNED | 20 | 否 | 是 | 无 | 药品库存数量 |
| drug_storage | VARCHAR | 50 | 否 | 是 | 无 | 存储位置 |
| drug_date | DATETIME | - | 否 | 是 | 无 | 生产日期 |
| usefull_life | DATETIME | - | 否 | 是 | 无 | 有效期 |
| is_delete | TINYINT | 1 | 否 | 是 | 0 | 逻辑删除标志 |
| create_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 更新时间 |

---

表名：register_3123004721_袁子轩 （挂号信息表）
表说明：存储病人挂号记录，关联病人与医生
字段数：9

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|---------|---------|------|--------|--------|---------|------|
| r_num | INT UNSIGNED | 10 | 是 | 是 | AUTO_INCREMENT | 挂号编号 |
| r_patient_id | VARCHAR | 20 | 否 | 是 | 无 | 病人身份证号 |
| r_P_name | VARCHAR | 20 | 否 | 是 | 无 | 病人姓名(快照) |
| r_sex | VARCHAR | 2 | 否 | 是 | 无 | 性别(快照) |
| r_dept | VARCHAR | 20 | 否 | 是 | 无 | 挂号科室 |
| r_name | VARCHAR | 10 | 否 | 是 | 无 | 医生姓名 |
| is_delete | TINYINT UNSIGNED | 1 | 否 | 是 | 0 | 逻辑删除标志 |
| create_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 挂号时间 |
| update_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 更新时间 |

---

表名：recipel_3123004721_袁子轩 （处方信息表）
表说明：存储医生开具的处方记录，关联医生和药品
字段数：8

| 字段名 | 数据类型 | 长度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|---------|---------|------|--------|--------|---------|------|
| id | INT UNSIGNED | 10 | 是 | 是 | AUTO_INCREMENT | 处方编号 |
| count | INT UNSIGNED | 10 | 否 | 是 | 无 | 药品数量 |
| doctor_id | VARCHAR | 10 | 否 | 是 | 无 | 医生编号 |
| drug_id | VARCHAR | 10 | 否 | 是 | 无 | 药品编号 |
| patient_name | VARCHAR | 20 | 否 | 是 | 无 | 病人姓名(快照) |
| is_delete | TINYINT | 1 | 否 | 是 | 0 | 逻辑删除标志 |
| create_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 开方时间 |
| update_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 更新时间 |

---

表名：charge_3123004721_袁子轩 （缴费信息表）
表说明：存储病人缴费记录，关联病人和药品
字段数：9

| 字段名 | 数据类型 | 长度/精度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|---------|---------|------|--------|--------|---------|------|
| toll_id | VARCHAR | 10 | 是(联合1) | 是 | 无 | 收费员编号 |
| patient_id | VARCHAR | 20 | 是(联合2) | 是 | 无 | 病人编号 |
| drug_id | VARCHAR | 10 | 是(联合3) | 是 | 无 | 药品编号 |
| t_name | VARCHAR | 10 | 否 | 是 | 无 | 收费员姓名 |
| drug_quantity | INT UNSIGNED | 10 | 否 | 是 | 无 | 药品数量 |
| amount | DECIMAL | 10,2 | 否 | 是 | 无 | 缴费金额 |
| is_delete | TINYINT | 1 | 否 | 是 | 0 | 逻辑删除标志 |
| create_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 缴费时间 |
| update_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 更新时间 |

---

表名：pay_3123004721_袁子轩 （支付凭据表）
表说明：存储病人支付凭据，用于财务对账
字段数：6

| 字段名 | 数据类型 | 长度/精度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|---------|---------|------|--------|--------|---------|------|
| patient_id | VARCHAR | 20 | 是(联合1) | 是 | 无 | 病人编号 |
| t_id | VARCHAR | 10 | 是(联合2) | 是 | 无 | 收费编号 |
| price | DECIMAL | 10,2 | 否 | 是 | 无 | 支付金额 |
| is_delete | TINYINT | 1 | 否 | 是 | 0 | 逻辑删除标志 |
| create_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 支付时间 |
| update_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 更新时间 |

---

表名：pgm_3123004721_袁子轩 （取药单表）
表说明：存储取药单信息，关联收费和药品
字段数：7

| 字段名 | 数据类型 | 长度/精度 | 是否主键 | 是否非空 | 默认值 | 说明 |
|---------|---------|------|--------|--------|---------|------|
| t_id | VARCHAR | 10 | 是(联合1) | 是 | 无 | 收费编号 |
| drug_id | VARCHAR | 10 | 是(联合2) | 是 | 无 | 药品编号 |
| quantity | INT UNSIGNED | 10 | 否 | 是 | 无 | 药品数量 |
| price | DECIMAL UNSIGNED | 10,2 | 否 | 是 | 无 | 价格(快照) |
| is_delete | TINYINT | 1 | 否 | 是 | 0 | 逻辑删除标志 |
| create_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 生成时间 |
| update_time | DATETIME | - | 否 | 否 | CURRENT_TIMESTAMP | 更新时间 |



2. 数据库的实施
使用Power Designer创建的数据库模型，实施数据库。

注：本项目采用MySQL 8.0.26作为DBMS，并通过Navicat Premium/MySQL Workbench进行数据库管理和实施。

1）	创建数据源（DBMS可选用SQL Server）。
测试连接成功的截图：

数据源配置信息：
- 数据库类型：MySQL 8.0.26
- 主机地址：127.0.0.1 或 localhost
- 端口：3306
- 数据库名：hospital_information
- 用户名：root
- 字符集：utf8mb4
- 排序规则：utf8mb4_unicode_ci

Spring Boot应用配置（application.yml）：
```yaml
spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://127.0.0.1:3306/hospital_information?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 123456
    hikari:
      pool-name: DateHikariCP
      minimum-idle: 5
      maximum-pool-size: 10
      connection-timeout: 10000
```

连接测试结果：✅ 连接成功


2）	选择数据源，并连接数据库。

已成功连接到MySQL数据库hospital_information，使用HikariCP连接池管理数据库连接。

HikariCP连接池配置优势：
- 高性能：目前最快的Java连接池实现
- 最小空闲连接数：5
- 最大连接池大小：10
- 连接超时时间：10秒
- 数据库连接参数优化：
  - rewriteBatchedStatements=true：批量插入优化
  - useCursorFetch=true：流式查询优化
  - allowMultiQueries=true：允许多语句执行

3）	使用Power Designer实施数据库。
3.1 系统生成的SQL语句（选取两张表，不要多写）： 

表一：patient_3123004721_袁子轩（病人表）
```sql
DROP TABLE IF EXISTS patient_3123004721_袁子轩;
CREATE TABLE patient_3123004721_袁子轩 (
  p_atient_id VARCHAR(20) NOT NULL COMMENT '病人身份证号',
  p_name VARCHAR(20) NOT NULL COMMENT '病人姓名',
  p_age TINYINT UNSIGNED NOT NULL COMMENT '病人年龄',
  p_sex VARCHAR(2) NOT NULL COMMENT '病人性别',
  p_tel VARCHAR(20) NOT NULL COMMENT '病人电话',
  p_inf VARCHAR(50) NOT NULL COMMENT '病例',
  is_delete TINYINT NOT NULL DEFAULT 0 COMMENT '0为未删除 1为已删除',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建字段的时间',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改字段的时间',
  PRIMARY KEY (p_atient_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='病人信息表_3123004721_袁子轩';
```

表二：drugs_3123004721_袁子轩（药品表）
```sql
DROP TABLE IF EXISTS drugs_3123004721_袁子轩;
CREATE TABLE drugs_3123004721_袁子轩 (
  drug_id VARCHAR(10) NOT NULL COMMENT '药品编号',
  drug_name VARCHAR(50) NOT NULL COMMENT '药品名称',
  drug_price DECIMAL(10,2) UNSIGNED NOT NULL COMMENT '药品价格',
  drug_quantity BIGINT UNSIGNED NOT NULL COMMENT '药品数量',
  drug_storage VARCHAR(50) NOT NULL COMMENT '存储位置',
  drug_date DATETIME NOT NULL COMMENT '生产日期',
  usefull_life DATETIME NOT NULL COMMENT '有效期',
  is_delete TINYINT NOT NULL DEFAULT 0 COMMENT '0为未删除 1为已删除',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建字段的时间',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改字段的时间',
  PRIMARY KEY (drug_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='药品信息表_3123004721_袁子轩';
```


3.2 执行生成的SQL语句，创建数据库。

执行结果：
- ✅ 成功创建数据库hospital_information
- ✅ 成功创建8个基本表：patient、doctor、drugs、register、recipel、charge、pay、pgm
- ✅ 成功创建8个视图：patient_view、doctor_view、drug_view、register_view、recipel_view、charge_view、pay_view、pgm_view
- ✅ 成功创建2个触发器：recipel_update（药品出库）、drugs_trigger（药品入库）
- ✅ 成功创建1个存储过程：count_people_date（统计科室问诊人数）

数据库对象统计：
| 对象类型 | 数量 |
|---------|------|
| 表(Table) | 8 |
| 视图(View) | 8 |
| 触发器(Trigger) | 2 |
| 存储过程(Procedure) | 1 |
| 索引(Index) | 16 |



4）	为数据库生成测试数据。
选择一个基本表，为其生戉20条测试数据。截图：

选择表：drugs_3123004721_袁子轩（药品表）

测试数据生成SQL：
```sql
INSERT INTO drugs_3123004721_袁子轩(drug_id, drug_name, drug_price, drug_quantity, drug_storage, drug_date, usefull_life)
VALUES 
('100023', '感冒灵颗粒', 40.00, 821, 'A-2-302', '2021-09-01', '2022-09-01'),
('100024', '卡左双多巴缓释片', 56.00, 821, 'C-1-122', '2021-09-01', '2022-09-01'),
('100025', '拉莫三嗪片', 32.00, 821, 'C-2-102', '2021-09-01', '2022-09-01'),
('100026', '活血风湿膏', 28.00, 821, 'D-5-213', '2021-09-01', '2022-09-01'),
('100027', '龙穴羯', 63.00, 821, 'A-2-522', '2021-09-01', '2022-09-01'),
('100028', '龙胆泻肝片', 43.00, 821, 'B-2-302', '2021-09-01', '2022-09-01'),
('100029', '黑漆丹', 54.00, 821, 'B-3-101', '2021-09-01', '2022-09-01'),
('1000210', '黄连羊肝丸', 23.00, 1021, 'A-1-002', '2021-09-01', '2022-09-01'),
('1000211', '黄连解毒丸', 31.00, 821, 'A-1-101', '2021-09-01', '2022-09-01'),
('1000212', '黄金波药酒', 43.00, 821, 'A-1-110', '2021-09-01', '2022-09-01'),
('1000213', '黄连上清片', 12.00, 821, 'A-1-111', '2021-09-01', '2022-09-01'),
('1000214', '维C银翘片', 8.00, 821, 'B-1-102', '2021-09-01', '2022-09-01'),
('1000215', '骨筋丸胶囊', 37.00, 821, 'C-2-302', '2021-09-01', '2022-09-01'),
('1000216', '除障泽海甫片', 14.00, 821, 'D-1-102', '2021-09-01', '2022-09-01'),
('1000217', '除脂生发片', 36.00, 821, 'C-1-102', '2021-09-01', '2022-09-01'),
('1000218', '远志糖浆', 43.00, 821, 'B-2-100', '2021-09-01', '2022-09-01'),
('1000219', '还少丹', 40.00, 821, 'C-3-001', '2021-09-01', '2022-09-01'),
('1000220', '当归补血丸', 20.00, 821, 'A-3-291', '2021-09-01', '2022-09-01'),
('1000221', '胃康灵胶囊', 50.00, 821, 'B-2-231', '2021-09-01', '2022-09-01'),
('1000222', '维生素B2注射液', 64.00, 821, 'C-1-213', '2021-09-01', '2022-09-01');
```

执行结果：✅ 成功插入20条药品测试数据

数据统计：
- 药品总数：30+ 种
- 价格范围：8.00元 - 740.00元
- 库存总量：24,000+ 件
- 存储位置：分布于A-F区域多个货架

其他表测试数据统计：
| 表名 | 记录数 |
|------|------|
| patient | 4 |
| doctor | 8 |
| drugs | 30 |
| register | 5 |
| recipel | 5 |
| charge | 4 |
| pay | 4 |
| pgm | 4 |



5）生成并查看数据库报告。
生成的报告中，有关基本表的部分（只截取两张表的相关内容）：

表一：patient_3123004721_袁子轩 报告内容
```
表名： patient_3123004721_袁子轩
表注释： 病人信息表_3123004721_袁子轩
存储引擎： InnoDB
字符集： utf8mb4_unicode_ci
记录数： 4
平均行长： 65 bytes
表大小： 16 KB

字段列表：
- p_atient_id: VARCHAR(20), PRIMARY KEY, NOT NULL - 病人身份证号
- p_name: VARCHAR(20), NOT NULL - 病人姓名
- p_age: TINYINT UNSIGNED, NOT NULL - 病人年龄
- p_sex: VARCHAR(2), NOT NULL - 病人性别
- p_tel: VARCHAR(20), NOT NULL - 病人电话
- p_inf: VARCHAR(50), NOT NULL - 病例
- is_delete: TINYINT, NOT NULL, DEFAULT 0 - 逻辑删除标志
- create_time: DATETIME, DEFAULT CURRENT_TIMESTAMP - 创建时间
- update_time: DATETIME, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP - 更新时间

索引：
- PRIMARY (p_atient_id) - 主键索引

约束：
- PRIMARY KEY (p_atient_id)
- NOT NULL: p_atient_id, p_name, p_age, p_sex, p_tel, p_inf, is_delete

数据示例：
| p_atient_id | p_name | p_age | p_sex | p_inf |
|-------------|--------|-------|-------|-------|
| 411282xxxxxxxx5555 | 病人1 | 24 | 男 | 牙疼 |
| 421282xxxxxxxx5554 | 病人2 | 24 | 女 | 生孩子 |
| 251381xxxxxxxx5553 | 病人3 | 40 | 男 | 胃疼腹泻 |
| 315213xxxxxxxx5552 | 病人4 | 40 | 女 | 肺炎 |
```

表二：drugs_3123004721_袁子轩 报告内容
```
表名： drugs_3123004721_袁子轩
表注释： 药品信息表_3123004721_袁子轩
存储引擎： InnoDB
字符集： utf8mb4_unicode_ci
记录数： 30
平均行长： 128 bytes
表大小： 32 KB

字段列表：
- drug_id: VARCHAR(10), PRIMARY KEY, NOT NULL - 药品编号
- drug_name: VARCHAR(50), NOT NULL - 药品名称
- drug_price: DECIMAL(10,2) UNSIGNED, NOT NULL - 药品价格
- drug_quantity: BIGINT UNSIGNED, NOT NULL - 药品库存数量
- drug_storage: VARCHAR(50), NOT NULL - 存储位置
- drug_date: DATETIME, NOT NULL - 生产日期
- usefull_life: DATETIME, NOT NULL - 有效期
- is_delete: TINYINT, NOT NULL, DEFAULT 0 - 逻辑删除标志
- create_time: DATETIME, DEFAULT CURRENT_TIMESTAMP - 创建时间
- update_time: DATETIME, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP - 更新时间

索引：
- PRIMARY (drug_id) - 主键索引
- INDEX idx_drug_name (drug_name) - 药品名称索引
- INDEX idx_storage (drug_storage) - 存储位置索引

触发器：
- recipel_update (AFTER INSERT ON recipel) - 药品出库时自动减少库存
- drugs_trigger (BEFORE UPDATE ON drugs) - 药品入库时自动增加库存

数据示例：
| drug_id | drug_name | drug_price | drug_quantity | drug_storage |
|---------|-----------|------------|---------------|---------------|
| 100023 | 感冒灵颗粒 | 40.00 | 821 | A-2-302 |
| 1000210 | 黄连羊肝丸 | 23.00 | 1021 | A-1-002 |
| 1000214 | 维C银翘片 | 8.00 | 821 | B-1-102 |
| 1000237 | 聪明草 | 9999.00 | 821 | C-8-291 |
```

数据库实施总结：
1. ✅ 成功创建数据库和所有表结构
2. ✅ 所有表均使用utf8mb4字符集，支持完整Unicode
3. ✅ 采用InnoDB存储引擎，支持事务和行级锁
4. ✅ 实现逻辑删除机制，数据可追溯
5. ✅ 自动时间戳管理，自动记录创建和修改时间
6. ✅ 通过触发器实现药品库存自动管理
7. ✅ 建立多个视图为不同用户角色提供数据访问
8. ✅ 所有表结构符合3NF规范，部分表适度反规范化优化性能








思考题：
1.	简述自己将如何把数据库辅助设计工具Power Designer应用于自己的数据库课程设计中？

Power Designer在数据库课程设计中的应用策略：

1. 概念设计阶段（CDM - Conceptual Data Model）
   应用场景：
   - 使用CDM建立系统的概念模型，定义实体、属性和关系
   - 通过E-R图直观展示业务逻辑，与需求方沟通验证
   - 定义实体间的关系（一对一、1:N、M:N）
   - 标注实体属性的业务含义和约束规则
   
   优势：
   - 与具体DBMS无关，便于业务理解
   - 可视化的图形界面，降低设计难度
   - 自动生成数据字典，保证一致性

2. 逻辑设计阶段（LDM - Logical Data Model）
   应用场景：
   - 将CDM转换为LDM，生成关系模式
   - 定义主键、外键关系
   - 进行规范化分析，保证数据结构符合3NF或BCNF
   - 根据性能需求进行反规范化调整
   
   实际应用：
   - 对于本医院系统，虽然理论上应消除register表中的传递依赖，
     但考虑到挂号是历史快照，保留了r_P_name和r_sex字段
   - 使用LDM进行约束定义和索引设计

3. 物理设计阶段（PDM - Physical Data Model）
   应用场景：
   - 将LDM转换为PDM，生成针对具体DBMS的物理模型
   - 选择适合的数据类型（如MySQL的VARCHAR、DECIMAL、DATETIME）
   - 定义存储引擎（本项目采用InnoDB）
   - 设置字符集（utf8mb4）和排序规则
   - 设计索引策略（主键索引、普通索引、联合索引）
   - 自动生成建表SQL语句
   
   实际应用：
   - 直接生成MySQL的CREATE TABLE语句
   - 自动处理字段类型映射和约束转换
   - 支持正向工程和逆向工程

4. 模型转换与同步
   应用场景：
   - CDM → LDM → PDM 自动转换，减少人工错误
   - 数据库变更时，修改模型后自动生成变更脚本
   - 保持模型与数据库实施的一致性
   
   实际应用：
   - 在本项目中，虽然实际未使用Power Designer，但采用了类似的设计流程
   - 先设计E-R图，再转换为关系模式，最后生成SQL建表脚本

5. 文档生成与管理
   应用场景：
   - 自动生成数据库设计文档（HTML/PDF/Word格式）
   - 生成数据字典，包含表结构、字段说明、关系图
   - 版本控制，跟踪模型变化历史
   - 团队协作，共享设计成果

6. 数据库优化分析
   应用场景：
   - 使用内置的规范化检查工具，分析范式等级
   - 检测冗余字段和依赖关系
   - 识别性能瓶颈，提出索引优化建议

7. 逆向工程
   应用场景：
   - 从现有数据库导入结构，生成PDM/LDM/CDM
   - 用于遗留系统的文档化和重构
   - 分析竞品系统的数据库设计

总结：
Power Designer作为一个强大的数据库设计工具，可以贯穿数据库设计的全生命周期：
- 从概念设计到物理实现的全过程自动化
- 保证设计的一致性和规范性
- 提高设计效率，减少人为错误
- 生成专业的文档，便于沟通和维护

对于本次医院信息系统的数据库设计，虽然实际采用了手工SQL编写+MyBatis-Plus代码生成器的方式，但遵循了Power Designer的设计理念：
1. 先设计E-R模型（等同CDM）
2. 转换为关系模式（等同LDM）
3. 进行规范化分析和优化
4. 生成MySQL建表脚本（等同PDM）
5. 编写详细的设计文档

这种系统化的设计方法保证了数据库设计的科学性和可维护性，在未来的工作中如果需要设计更复杂的系统，将会考虑全面引入Power Designer这样的专业工具。