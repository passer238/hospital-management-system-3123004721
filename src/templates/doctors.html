{% extends 'base.html' %}

{% block content %}
<div class="row mb-4 align-items-center">
    <div class="col">
        <h2 class="fw-bold mb-0 text-primary"><i class="bi bi-person-badge me-2"></i>医生管理</h2>
    </div>
    <div class="col-auto">
        <span class="badge bg-primary-subtle fs-6 rounded-pill px-3">{{ doctors|length }} 位在岗医生</span>
    </div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-white border-bottom-0 pt-4 pb-0">
        <h5 class="fw-bold text-primary mb-0"><i class="bi bi-plus-circle me-2"></i>新增医生</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('doctors') }}">
            <div class="row g-3 mb-3">
                <div class="col-md-2">
                    <div class="form-floating">
                        <input type="number" class="form-control" name="d_octor_id" id="new_d_id" placeholder="医生编号"
                            required>
                        <label for="new_d_id">医生编号</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-floating">
                        <input type="text" class="form-control" name="d_name" id="new_d_name" placeholder="姓名" required>
                        <label for="new_d_name">姓名</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-floating">
                        <select class="form-select" name="d_sex" id="new_d_sex" required>
                            <option value="" selected disabled>选择</option>
                            <option value="男">男</option>
                            <option value="女">女</option>
                        </select>
                        <label for="new_d_sex">性别</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-floating">
                        <input type="number" class="form-control" name="d_age" id="new_d_age" placeholder="年龄" required>
                        <label for="new_d_age">年龄</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-floating">
                        <input type="text" class="form-control" name="d_dept" id="new_d_dept" placeholder="科室" required>
                        <label for="new_d_dept">科室</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-floating">
                        <input type="text" class="form-control" name="d_tel" id="new_d_tel" placeholder="电话" required>
                        <label for="new_d_tel">电话</label>
                    </div>
                </div>
            </div>
            <div class="text-end">
                <button type="submit" class="btn btn-primary px-4"><i class="bi bi-person-plus me-1"></i>添加医生</button>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header bg-white pt-4 pb-2">
        <h5 class="fw-bold text-primary mb-0"><i class="bi bi-list-ul me-2"></i>医生列表</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>编号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>年龄</th>
                        <th>科室</th>
                        <th>电话</th>
                        <th class="text-end">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in doctors %}
                    <tr>
                        <td><span class="badge bg-light text-dark border">{{ doc.d_octor_id }}</span></td>
                        <td class="fw-medium">{{ doc.d_name }}</td>
                        <td>
                            {% if doc.d_sex == '男' %}
                            <i class="bi bi-gender-male text-primary"></i>
                            {% else %}
                            <i class="bi bi-gender-female text-danger"></i>
                            {% endif %}
                            {{ doc.d_sex }}
                        </td>
                        <td>{{ doc.d_age }}岁</td>
                        <td><span class="badge bg-primary-subtle">{{ doc.d_dept }}</span></td>
                        <td>{{ doc.d_tel }}</td>
                        <td class="text-end">
                            <div class="btn-group">
                                <button type="button" class="btn btn-outline-warning btn-sm"
                                    onclick="editDoctor({{ doc.d_octor_id }}, '{{ doc.d_name }}', '{{ doc.d_sex }}', {{ doc.d_age }}, '{{ doc.d_dept }}', '{{ doc.d_tel }}')">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <form action="{{ url_for('delete_doctor', id=doc.d_octor_id) }}" method="POST"
                                    class="d-inline">
                                    <button type="submit" class="btn btn-outline-danger btn-sm"
                                        onclick="return confirm('确定要删除该医生吗？')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 编辑医生模态框 -->
<div class="modal fade" id="editDoctorModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>编辑医生信息</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('edit_doctor_submit') }}">
                <div class="modal-body p-4">
                    <input type="hidden" name="d_octor_id" id="edit_d_octor_id">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label text-muted small text-uppercase fw-bold">姓名</label>
                            <input type="text" class="form-control" name="d_name" id="edit_d_name" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small text-uppercase fw-bold">性别</label>
                            <select class="form-select" name="d_sex" id="edit_d_sex" required>
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small text-uppercase fw-bold">年龄</label>
                            <input type="number" class="form-control" name="d_age" id="edit_d_age" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small text-uppercase fw-bold">科室</label>
                            <input type="text" class="form-control" name="d_dept" id="edit_d_dept" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label text-muted small text-uppercase fw-bold">电话</label>
                            <input type="text" class="form-control" name="d_tel" id="edit_d_tel" required>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="submit" class="btn btn-primary px-4">保存修改</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function editDoctor(id, name, sex, age, dept, tel) {
        document.getElementById('edit_d_octor_id').value = id;
        document.getElementById('edit_d_name').value = name;
        document.getElementById('edit_d_sex').value = sex;
        document.getElementById('edit_d_age').value = age;
        document.getElementById('edit_d_dept').value = dept;
        document.getElementById('edit_d_tel').value = tel;

        new bootstrap.Modal(document.getElementById('editDoctorModal')).show();
    }
</script>
{% endblock %}